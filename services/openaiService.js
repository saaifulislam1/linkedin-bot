// openaiService.js (fully ESM compatible)
import "dotenv/config.js";
import { OpenAI } from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function generatePost(topic) {
  const prompt = `
তুমি একজন সফটওয়্যার ইঞ্জিনিয়ার যার অভিজ্ঞতা ৮ বছরের বেশি। জটিল কনসেপ্টগুলো সহজ ও পরিষ্কারভাবে বোঝাতে তুমি বেশ দক্ষ।  
তোমার লক্ষ্য হলো – "${topic}" এই বড় বিষয়ের একটি নির্দিষ্ট ফিচার বা গুরুত্বপূর্ণ উপ-টপিক নিয়ে একটি মৌলিক লিংকডইন পোস্ট লেখা, যা ডেভেলপারদের জন্য মধ্য থেকে অ্যাডভান্সড লেভেলের বিষয়গুলো সহজভাবে শেখার সুযোগ করে দেয়।

নিচের নির্দেশনাগুলো অনুসরণ করো:

1. **ফোকাস করো:**  
"${topic}" বিষয়ের মধ্যে একটি নির্দিষ্ট ফিচার, ধারণা বা গুরুত্বপূর্ণ সাব-টপিক বেছে নাও এবং সেটার উপর গভীরভাবে আলোকপাত করো।

2. **ভাষা ও টোন:**  
বন্ধুসুলভ, পরিষ্কার এবং সহজ ভাষায় লেখো। যাতে জুনিয়র থেকে সিনিয়র সবাই বুঝতে পারে। তবে বিষয়টা যেন মিড-টু-অ্যাডভান্সড লেভেলের হয়।

3. **বিষয়ের গভীরতা:**  
- পুরো বিষয়ের বেসিক ব্যাখ্যা না দিয়ে শুধু বেছে নেওয়া টপিকেই ফোকাস করো।  
- ব্যাখ্যা করো এটি কী কাজে লাগে, কিভাবে কাজ করে, সেরা ব্যবহার কৌশল (best practices), সাধারণ ভুলগুলো কী, এবং দরকারি টিপস।  
- নতুন ও অপ্রচলিত ইনসাইট শেয়ার করো যাতে পোস্টটা ইউনিক হয়।

4. **স্ট্রাকচার ও স্টাইল:**  
- শুরুতে লিখো কেন এই ফিচার/টপিক এখন গুরুত্বপূর্ণ।  
- গল্প বলার ভঙ্গিতে ব্যাখ্যা করো, উদাহরণ দাও যাতে সহজে বোঝা যায়।  
- সত্যজিত রায়ের মত গভীর ও ভাবনাসমৃদ্ধ লেখা এবং জর্জ আর. আর. মার্টিনের মত গল্প বলার স্টাইল থেকে অনুপ্রেরণা নাও, তবে লেখাটা যেন সহজ ও প্রাঞ্জল হয়।

5. **হ্যাশট্যাগ:**  
শেষে ৩ থেকে ৫টি জনপ্রিয় ও প্রাসঙ্গিক হ্যাশট্যাগ যোগ করো, যাতে লিংকডইনে আরও বেশি মানুষ পোস্টটি খুঁজে পায়।

6. **Engagement বাড়াও:**  
শেষে একটি প্রশ্ন বা চ্যালেঞ্জ দাও, যাতে অন্যরাও কমেন্টে নিজের মতামত বা অভিজ্ঞতা শেয়ার করতে আগ্রহী হয়।

7. **নিজের কথা বলো না:**  
নিজের কাজের অভিজ্ঞতা, পজিশন বা নিজের নাম উল্লেখ করো না। লেখার মানের মধ্য দিয়েই দক্ষতা প্রকাশ হোক।

8. **দৈর্ঘ্য:**  
লেখাটা ২৫০ শব্দের আশেপাশে রাখো — যাতে যথেষ্ট ব্যাখ্যা থাকে কিন্তু পড়তেও সহজ হয়।

ফলাফল হবে: "${topic}" বিষয়ের একটি নির্দিষ্ট অংশ নিয়ে পরিষ্কার, আকর্ষণীয় ও উপকারী একটি পোস্ট, যা ডেভেলপারদের শেখার সুযোগ ও আলোচনার উৎসাহ দেবে।
`;

  const response = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{ role: "user", content: prompt.trim() }],
    temperature: 0.8,
  });

  return response.choices[0].message.content.trim();
}

export async function summarizePost(postContent) {
  const summaryPrompt = `
Summarize the following LinkedIn post in less then 2 Sentence , and less then 30 words. Keep it clear, concise, and informative:

${postContent}
`;

  const summaryResponse = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{ role: "user", content: summaryPrompt.trim() }],
    temperature: 0.7,
  });

  return summaryResponse.choices[0].message.content.trim();
}
