// openaiService.js (fully ESM compatible)
import "dotenv/config.js";
import { OpenAI } from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

export async function generatePost(topic) {
  const prompt = `
তুমি একজন অভিজ্ঞ সফটওয়্যার ইঞ্জিনিয়ার (৮+ বছরের অভিজ্ঞতা) যিনি জটিল টেকনিক্যাল ধারণাগুলোকে খুব সহজ, প্রাঞ্জল ও প্রাসঙ্গিক বাংলায় ব্যাখ্যা করতে পারো।  
তোমার কাজ হলো – "${topic}" এই বড় বিষয়ের ভেতর থেকে একটি নির্দিষ্ট ফিচার, ধারণা বা গুরুত্বপূর্ণ সাব-টপিক বেছে নিয়ে একটি ইউনিক, শিক্ষামূলক ও আকর্ষণীয় লিংকডইন পোস্ট তৈরি করা, যা ডেভেলপারদের জন্য বিশেষভাবে সহায়ক হবে।

নির্দেশনা:

1. **টপিক বাছাই ও গভীরতা**  
   - "${topic}" এর মধ্যে এমন একটি নির্দিষ্ট ফিচার বা সাব-টপিক বেছে নাও যা এখনকার সময়ে গুরুত্বপূর্ণ এবং আলোচনাযোগ্য।  
   - বেসিক বিষয় বাদ দিয়ে সরাসরি সেই সাব-টপিকের গভীরে যাও।  
   - ব্যাখ্যা করো: এটি কী, কেন দরকার, কীভাবে কাজ করে, সেরা ব্যবহার কৌশল (best practices), সাধারণ ভুল ও এড়ানোর উপায়, এবং দরকারি টিপস।  
   - এমন ইনসাইট দাও যা সাধারণ ব্লগ বা পোস্টে সচরাচর পাওয়া যায় না।

2. **ভাষা ও টোন**  
   - বাংলাটা হতে হবে খুবই সহজ, সরল, কিন্তু গুণে ভরপুর।  
   - উদাহরণ, তুলনা ও ছোট গল্প ব্যবহার করে বোঝাও — যাতে জুনিয়র থেকে সিনিয়র সবাই বুঝতে পারে।  
   - টোন হবে বন্ধুসুলভ, অনুপ্রেরণামূলক ও চিন্তা জাগানিয়া।

3. **স্টাইল**  
   - প্রথমেই বোঝাও কেন এই বিষয়টি এখন গুরুত্বপূর্ণ বা উপকারী।  
   - ব্যাখ্যার মধ্যে গল্প বলার ঢঙ রাখো, যাতে পাঠক জড়িয়ে থাকে।  
   - সত্যজিৎ রায়ের মতো গভীরতা ও ভাবনার ছোঁয়া, আর জর্জ আর. আর. মার্টিনের মতো কাহিনি বলার স্টাইল থেকে অনুপ্রেরণা নাও — তবে লেখাটা যেন খুব হালকা ও স্বাভাবিকভাবে পড়া যায়।

4. **Engagement ও সমাপ্তি**  
   - শেষে ৩–৫টি প্রাসঙ্গিক ও জনপ্রিয় হ্যাশট্যাগ দাও (বাংলা বা ইংরেজি মিশ্রণে)।  
   - পোস্টের শেষে এমন একটি প্রশ্ন বা ছোট চ্যালেঞ্জ দাও যা পাঠককে কমেন্টে নিজের মতামত বা অভিজ্ঞতা শেয়ার করতে উৎসাহিত করবে।  
   - নিজের ব্যক্তিগত অভিজ্ঞতা, পজিশন বা নাম উল্লেখ করো না — লেখার মানের মাধ্যমেই দক্ষতা প্রকাশ পাক।

5. **দৈর্ঘ্য**  
   - পোস্টটি ২৫০ শব্দের কাছাকাছি রাখো — যাতে তথ্য সমৃদ্ধ হয় কিন্তু পড়তে সহজ থাকে।

চূড়ান্ত আউটপুট: "${topic}" এর একটি নির্দিষ্ট ফিচার বা সাব-টপিক নিয়ে প্রাঞ্জল, গভীর এবং সহজবোধ্য একটি ইউনিক লিংকডইন পোস্ট, যা ডেভেলপারদের শেখার ও আলোচনার সুযোগ তৈরি করবে।
`;

  const response = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{ role: "user", content: prompt.trim() }],
    temperature: 0.8,
  });

  return response.choices[0].message.content.trim();
}

export async function summarizePost(postContent) {
  const summaryPrompt = `
Summarize the following LinkedIn post in less then 2 Sentence , and less then 30 words. Keep it clear, concise, and informative:

${postContent}
`;

  const summaryResponse = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{ role: "user", content: summaryPrompt.trim() }],
    temperature: 0.7,
  });

  return summaryResponse.choices[0].message.content.trim();
}
